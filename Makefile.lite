# ==============================================================================
# ‚ú® Aqeel's Enchanted Makefile System ‚ú® https://aqeelakber.com/Makefile ‚ú®
# ü™Ñ For you:
# üêà‚Äç This Makefile is quietly watched over by an enchanted cat.
# üßô Minimal Configuration ‚Äì edit just these:
PROJECT_USE        = Your Project Name (Customize Me!)
# ==============================================================================

# ------------------------------------------------------------------------------
# Derived ‚Äì no need to edit unless you're hacking the system
# ------------------------------------------------------------------------------
GIT_COMMIT          := $(strip $(shell git rev-parse --short HEAD))
GIT_BRANCH          := $(shell git rev-parse --abbrev-ref HEAD)
WORKTREE_DIRTY      := $(shell test -n "$$(git status --porcelain)" && echo "yes" || echo "no")
GIT_REMOTE_URL      := $(shell git remote get-url origin 2>/dev/null || echo "N/A")
GIT_REPO_PATH       := $(shell git remote get-url origin | sed -E 's#.*[:/]([^/]+/[^/.]+)(\.git)?$$#\1#')
OS                  := $(shell uname)

# ------------------------------------------------------------------------------
# Help System
# ------------------------------------------------------------------------------
default: help

help: ## Display available make targets with descriptions and project info
	@echo "‚ú® Welcome to Aqeel's Enchanted Makefile ‚ú®"
	@echo "ü™Ñ For you: $(PROJECT_USE)"
	@echo "-----------------------------------------"
	@if [ "$(WORKTREE_DIRTY)" = "yes" ]; then \
		echo "‚ö† Git working directory has uncommitted changes."; \
	fi
	@echo "üìÇ Project:   $(GIT_REPO_PATH)"
	@echo "üåê Remote:    $(GIT_REMOTE_URL)"
	@echo "üåø Branch:    $(GIT_BRANCH)"
	@echo
	@echo "Commands:"
	@grep -E '^[a-zA-Z0-9/_-]+:.*?##' $(MAKEFILE_LIST) | sort | \
		awk 'BEGIN {FS = ":.*?## "}; \
		{ printf "  \033[36m%-25s\033[0m %s\n", $$1, $$2 }'
	@echo "-----------------------------------------"

# ------------------------------------------------------------------------------
# ‚ú® Aqeel's Enchanted Makefile ‚ú®
# ü™Ñ Magic: Use '##' to auto-document targets (see: make help)
# Example:
# dev/shell: ## Open dev shell
#     $(CONTAINER_RUNTIME) run $(CONTAINER_ARGS) $(IMAGE_BASE) bash
# For licence and snippets visit:
# üìñ github.com/admiralakber/enchanted-makefile
# ------------------------------------------------------------------------------

# ------------------------------------------------------------------------------
# Declare phony targets
# ------------------------------------------------------------------------------
.PHONY: default help
